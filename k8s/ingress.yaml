apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: grpc-hello-ingress
  annotations:
    # 为gRPC端口配置GRPC协议
    nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
    # 配置gRPC超时设置
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "1800"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "1800"
spec:
  tls:
    - hosts:
        - grpc-hello.local
      secretName: grpc-tls-secret
  rules:
    - host: grpc-hello.local
      http:
        paths:
          # gRPC服务路由 - 根路径
          - path: /
            pathType: Prefix
            backend:
              service:
                name: grpc-hello-svc
                port:
                  number: 50051
          # Metrics端点路由 - 精确匹配/metrics路径
          - path: /metrics
            pathType: Exact
            backend:
              service:
                name: grpc-hello-svc
                port:
                  number: 8090